<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم - Berlin Store</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: #fff;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .container {
            width: 100%;
            max-width: 500px;
            background: rgba(22, 33, 62, 0.9);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(255,204,0,0.2);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        h2 {
            text-align: center;
            color: #ffcc00;
            margin-bottom: 20px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #a6a6a6;
            font-size: 0.9rem;
        }

        input {
            width: 100%;
            padding: 12px;
            background: #0f3460;
            border: 1px solid #16213e;
            border-radius: 8px;
            color: #fff;
            box-sizing: border-box;
            outline: none;
            transition: 0.3s;
        }

            input:focus {
                border-color: #ffcc00;
            }

        button {
            width: 100%;
            padding: 12px;
            background: #e94560;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin-top: 10px;
            transition: 0.3s;
        }

            button:hover {
                background: #ff2e63;
                transform: translateY(-2px);
            }

        .product-list {
            margin-top: 30px;
            max-height: 300px;
            overflow-y: auto;
        }

        .item {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .delete-btn {
            background: transparent;
            color: #ff4757;
            width: auto;
            padding: 5px;
            margin: 0;
            font-size: 12px;
            border: 1px solid #ff4757;
        }

            .delete-btn:hover {
                background: #ff4757;
                color: white;
            }

        #login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a1a2e;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>

    <div id="login-screen">
        <h3 style="color: #ffcc00;">🔐 أدخل كود الأدمن</h3>
        <input type="password" id="admin-pass" style="width: 250px; text-align: center; margin-bottom: 15px;" placeholder="Password">
        <button onclick="checkAdmin()" style="width: 250px; background: #ffcc00; color: #000;">دخول</button>
    </div>

    <div class="container" id="dashboard" style="display: none;">
        <h2>إضافة منتج جديد 🔥</h2>

        <div class="input-group">
            <label>اسم المنتج</label>
            <input type="text" id="p-title" placeholder="مثال: حساب فورتنايت نادر">
        </div>
        <div class="input-group">
            <label>السعر (EGP)</label>
            <input type="number" id="p-price" placeholder="500">
        </div>
        <div class="input-group">
            <label>رابط الصورة</label>
            <input type="text" id="p-image" placeholder="https://...">
        </div>
        <div class="input-group">
            <label>وصف قصير</label>
            <input type="text" id="p-desc" placeholder="وصف يظهر تحت الصورة">
        </div>

        <button onclick="addProduct()">➕ إضافة للموقع</button>
        <p id="status-msg" style="text-align: center; margin-top: 10px; font-size: 0.9rem;"></p>

        <h3 style="margin-top: 30px; border-bottom: 1px solid #333; padding-bottom: 10px;">المنتجات المضافة</h3>
        <div id="added-products-list" class="product-list"></div>
    </div>

    <script>
        // ⚠️ إعدادات الفايربيس (نفس الموجودة في موقعك)
        const firebaseConfig = {
            apiKey: "AIzaSyAsrl6fyQ65lGU22WlTsm8HDtjhKYKw4bs",
            authDomain: "berlin-storegoe-login.firebaseapp.com",
            projectId: "berlin-storegoe-login",
            storageBucket: "berlin-storegoe-login.firebasestorage.app",
            messagingSenderId: "429636991312",
            appId: "1:429636991312:web:38bb70e5186173ae809455",
            measurementId: "G-WGF1G0B6FD"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function checkAdmin() {
            if (document.getElementById('admin-pass').value === "Berlin2026") {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                loadAddedProducts();
            } else { alert("كلمة المرور خاطئة!"); }
        }

        function addProduct() {
            const title = document.getElementById('p-title').value;
            const price = parseFloat(document.getElementById('p-price').value);
            const image = document.getElementById('p-image').value;
            const desc = document.getElementById('p-desc').value;

            if (!title || !price || !image) { alert("أكمل البيانات!"); return; }

            const btn = document.querySelector('button[onclick="addProduct()"]');
            btn.textContent = "جاري الحفظ...";
            btn.disabled = true;

            db.collection("best_sellers_products").add({
                id: "custom_" + Date.now(),
                title: title,
                price: price,
                usd_price: (price / 50),
                image: image,
                shortDescription: desc,
                fullDescription: desc,
                category: "games",
                platform: "steam",
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                document.getElementById('status-msg').style.color = "#00ff00";
                document.getElementById('status-msg').textContent = "تمت الإضافة بنجاح!";
                btn.textContent = "➕ إضافة للموقع";
                btn.disabled = false;
                document.getElementById('p-title').value = '';
                document.getElementById('p-price').value = '';
                loadAddedProducts();
            }).catch(e => { console.error(e); alert("خطأ!"); });
        }

        function loadAddedProducts() {
            const list = document.getElementById('added-products-list');
            list.innerHTML = "جاري التحميل...";
            db.collection("best_sellers_products").orderBy("createdAt", "desc").get().then((snap) => {
                list.innerHTML = "";
                snap.forEach((doc) => {
                    const d = doc.data();
                    list.innerHTML += `
                            <div class="item">
                                <span>${d.title} (${d.price} EGP)</span>
                                <button class="delete-btn" onclick="deleteProduct('${doc.id}')">حذف</button>
                            </div>`;
                });
            });
        }

        function deleteProduct(id) {
            if (confirm("حذف المنتج؟")) {
                db.collection("best_sellers_products").doc(id).delete().then(loadAddedProducts);
            }
        }
        document.addEventListener('DOMContentLoaded', function () {
            // تأكد من تهيئة الفايربيس هنا مرة أخرى للأمان
            if (!firebase.apps.length) {
                firebase.initializeApp({
                    apiKey: "AIzaSyAsrl6fyQ65lGU22WlTsm8HDtjhKYKw4bs",
                    authDomain: "berlin-storegoe-login.firebaseapp.com",
                    projectId: "berlin-storegoe-login",
                    storageBucket: "berlin-storegoe-login.firebasestorage.app",
                    messagingSenderId: "429636991312",
                    appId: "1:429636991312:web:38bb70e5186173ae809455",
                    measurementId: "G-WGF1G0B6FD"
                });
            }

            // استدعاء الدالة
            loadGamesToHome();
        });
    </script>
</body>
</html>